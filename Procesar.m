%Test Script con datos reales
clear;
%% Carga de RUTAS
%carpeta='/home/gvilla/Downloads/PhPo/';
%carpeta=['D:\Jevo\Documentos\Matematica aplicada\XM\Bases de datos',sl];
% carpeta=['D:\Jevo\Documentos\Matematica aplicada\XM\Bases de datos\Prueba\'];
% archivos={'Cerromatoso1','Cerromatoso2','Cerromatoso3','Cerromatoso4','Enea1','Enea2','Enea3','Guavio1','Guavio2','Guavio3','Guavio4'};
% RUTAS=cell(length(archivos),1);
% for i=1:length(archivos)
%     RUTAS{i}=[carpeta,archivos{i},'.csv'];
% end
% clear carpeta archivos i
RUTAS ={'/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180710001451-20180712061951.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180712061951-20180714114336.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180714114337-20180716171026.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180716171026-20180718225234.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180718225234-20180721040945.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180721040945-20180723092544.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180723092544-20180725144508.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180725144508-20180727200153.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180727200153-20180730011751.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180730011751-20180801063806.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180801063806-20180803123018.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180803123018-20180805182513.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180805182513-20180808001639.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180808001640-20180810061422.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180810061422-20180812113629.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180812113629-20180814171847.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180814171847-20180816225234.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-11-LaEnea230-20180816225234-20180817100930.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180701000000-20180703054335.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180703054335-20180705112709.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180705112709-20180707171036.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180707171036-20180709225411.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180709225411-20180712040928.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180712040928-20180714092328.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180714092328-20180716143714.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180716143714-20180718195220.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180718195220-20180721010640.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180721010640-20180723062052.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180723062052-20180725113553.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180725113553-20180727165007.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180727165007-20180729220412.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180729220413-20180801032014.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180801032014-20180803090356.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180803090356-20180805144743.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180805144743-20180807203149.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180807203149-20180810021414.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180810021414-20180812072823.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180812072823-20180814124232.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180814124232-20180816175642.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-2-GUAVIO2-20180816175642-20180817100930.csv';...
    % '/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180701000000-20180704232005.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180704232005-20180708223700.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180708223700-20180712205001.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180712205001-20180716183448.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180716183448-20180720162002.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180720162002-20180724140358.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180724140358-20180728114745.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180728114745-20180801091053.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180801091053-20180805123403.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180805123403-20180809132736.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180809132736-20180813112146.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180813112146-20180817090740.csv';...
    %'/home/gvilla/Downloads/PhPo/C37118-40-IT Tctg4904-20180817090740-20180817100930.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180701000000-20180703045820.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180703045820-20180705195558.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180705195558-20180708053217.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180708053218-20180710102514.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180710102514-20180712145457.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180712145457-20180714192451.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180714192451-20180716235549.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180716235549-20180719042628.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180719042628-20180721085622.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180721085622-20180723132541.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180723132541-20180725175523.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180725175523-20180727222523.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180727222523-20180730025501.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180730025501-20180801072913.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180801072913-20180803122805.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180803122805-20180805172652.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180805172652-20180807222508.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180807222508-20180810032226.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180810032226-20180812075216.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180812075216-20180814122252.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180814122252-20180816165338.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-44-Cerromatoso110_1-20180816165338-20180817100930.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180701000000-20180704063730.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180704063730-20180706223547.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180706223547-20180709074453.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180709074454-20180711131816.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180711131816-20180713184236.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180713184236-20180716045139.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180716045139-20180718135709.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180718135709-20180720223736.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180720223736-20180723210307.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180723210307-20180726112517.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180726112517-20180728234510.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180728234510-20180731190026.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180731190026-20180803030826.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180803030826-20180805140027.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180805140027-20180807210406.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180807210406-20180810051526.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180810051526-20180812114335.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180812114335-20180814170746.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180814170747-20180817013855.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-51-Guavio_Caverna_U-20180817013855-20180817100930.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180701000000-20180703065045.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180703065045-20180705134124.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180705134124-20180707203211.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180707203211-20180710032158.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180710032158-20180712094208.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180712094208-20180714160208.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180714160208-20180716222305.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180716222305-20180719044334.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180719044334-20180721110336.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180721110336-20180723172339.csv';...
    '/home/gvilla/Downloads/PhPo/C37118-60-Bacata-20180723172339-20180725234428.csv'
    };
%% Estableciendo nombres de las fases y de archivos
nFase.fase0='fase0'; %Datos alineados en la misma ventana de tiempo
nFase.fase1='fase1'; %Patrones creados y limpiados
nFase.pFase1='voltajes'; %Archivo .mat que contiene los patrones alineados y normalizados
nFase.sFase1='Norm'; %Sufijo del archivo que contiene la normalizacion de los patrones (pFase1_sFase1)
nFase.fase2='fase2'; %Clasificacion de patrones
nFase.fase3='fase3'; %Creacion de transiciones unicas
%% Deteccion de carpeta asumiendo que todos los archivos .csv estan en una misma carpeta
sl='/';
slash=strfind(RUTAS{1},sl);
carpeta=RUTAS{1}(1:slash(end));
clear slash;
%% Fase 0 alineacion de hidroelectricas
%% Separacion de hidroelectricas
indice=[1,19,41,63,83];    %Real
%indice=[1,5,8,11];          %Prueba
hidr=length(indice)-1; %Cantidad de hidroelectricas
nombres=cell(hidr,1);
for i=1:hidr
    nombres{i}=['data',num2str(i)];
end
%% Se detecta la existencia de los datos de fase0
exis=true;
i=1;
while exis&&i<=hidr
    file=sprintf('data%d.mat',i);
    exis=exis&&exist([carpeta,'Datos Procesados',sl,nFase.fase0,sl,file],'file');
    i=i+1;
end
%% Si no existen se alinean las hidroelectricas
if ~exis
    %% Alineacion de hidroelectricas
    %Tiempo promedio para obtener la interseccion de los archivos de la ENEA2,
    %GUAVIO2 y CERROMATOSO es de 5 minutos con 55 segundos
    %Deteccion de la existencia de interseccion
    exis=exist([carpeta,'Datos Procesados',sl,nFase.fase0,sl,'interseccion.mat'],'file');
    %Si no existe se crea
    if ~exis
        tic
        [interseccion]=alinea(18,RUTAS,indice);% t=5 min 55 seg
        toc
        %Guardando interseccion
        [~,~,~]=mkdir(carpeta,'Datos Procesados');
        [~,~,~]=mkdir([carpeta,'Datos Procesados',sl],nFase.fase0);
        save([carpeta,'Datos Procesados',sl,nFase.fase0,sl,'interseccion.mat'],'interseccion','-v7.3');
    end
    %Se carga interseccion siempre y cuando no est� en el workspace
    exis=exist('interseccion','var');
    if ~exis
        load([carpeta,'Datos Procesados',sl,nFase.fase0,sl,'interseccion.mat']);
    end
    title='Alineacion y Guardado';
    indent=0;
    prctg=0;
    %Creando orden de cada archivo
    %1:Frecuencia
    %2:VA
    %3:TethaA
    %4:VB
    %5:TethaB
    %6:VC
    %7:TethaC
    orden=[
        1 4 5 2 3 6 7;%La Enea
        1 2 3 6 7 4 5;%Guavio2
        1 6 7 4 5 2 3;%Cerromatoso
        1 6 7 4 5 2 3;%Guavio caverna
        ];
    % Creando la carpeta Datos Procesados y fase0 (Alineados)
    [~,~,~]=mkdir(carpeta,'Datos Procesados');
    [~,~,~]=mkdir([carpeta,'Datos Procesados',sl],nFase.fase0);
    h=progress1(indent,title,0);
    for i=1:hidr
        name=nombres{i};
        tic;[~,data]=alinea(18,RUTAS,indice(i:i+1),interseccion);toc;
        %Quitando las fechas
        data=data{1};
        %Organizando columnas
        data(:,orden(i,:))=data;
        %% Guardando variables procesadas
        filename=[carpeta,'Datos Procesados',sl,nFase.fase0,sl,sprintf('data%d.mat',i)];
        save(filename,'data','-v7.3');
        h=progress1(indent,title,i/(length(indice)-1),h);
    end
end
%% Eliminacion de variables innecesarias
clear indice exis file i data
%% Creacion rutas de archivos de fase0
PATHS=cell(hidr,1);
for i=1:hidr
    PATHS{i}=[carpeta,'Datos Procesados',sl,nFase.fase0,sl,sprintf('data%d.mat',i)];
end
%% Fase 1 creacion y normalizacion de patrones
%% Se detecta la existencia de los datos de fase1
exis=exist([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'.mat'],'file');
exis=exis&&exist([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_',nFase.sFase1,'.mat'],'file');
exis=exis&&exist([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_inRaros1.mat'],'file');
exis=exis&&exist([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_inRaros2.mat'],'file');
exis=exis&&exist([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_noNanIndex.mat'],'file');
%Si no existen, se crean y guardan los patrones
if ~exis
    %% Creacion, limpieza y normalizacion de patrones
    %   Creacion
    [patrones,nanIndex,inRaros1,inRaros2]=crearPVolA(PATHS); %Voltages
    %patrones=clean(patrones,nanIndex); %Ya no se limpiaran los patrones
    %% Determinacion de indices donde no hay valores nan
    mIndex=size(patrones,1);
    noNanIndex=comple(nanIndex,mIndex);
    %   Normalizacion para las tensiones
    [patrones(noNanIndex,:),N]=normaliza(patrones(noNanIndex,:));
    %% Guardando variables procesadas
    %   Creando la carpeta fase1 (Patrones)
    h=progress1(0,'Guardando Variables fase1 ',0,'text');
    [~,~,~]=mkdir(carpeta,'Datos Procesados');
    [~,~,~]=mkdir([carpeta,'Datos Procesados',sl],nFase.fase1);
    save([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'.mat'],'patrones','-v7.3');
    h=progress1(0,'Guardando Variables fase1 ',1/6,h,'text');
    save([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_inRaros1.mat'],'inRaros1','-v7.3');
    h=progress1(0,'Guardando Variables fase1 ',2/6,h,'text');
    save([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_inRaros2.mat'],'inRaros2','-v7.3');
    h=progress1(0,'Guardando Variables fase1 ',3/6,h,'text');
    save([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_nanIndex.mat'],'nanIndex','-v7.3');
    h=progress1(0,'Guardando Variables fase1 ',4/6,h,'text');
    save([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_noNanIndex.mat'],'noNanIndex','-v7.3');
    h=progress1(0,'Guardando Variables fase1 ',5/6,h,'text');
    save([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_',nFase.sFase1,'.mat'],'N','-v7.3');
    h=progress1(0,'Guardando Variables fase1 ',6/6,h,'text');
    
end
%% Cargando variables de la fase1 siempre y cuando no est�n en el workspace
exis=exist('patrones','var');
if ~exis
    patrones=struct2array(load([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'.mat']));
    nanIndex=struct2array(load([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_nanIndex.mat']));
    noNanIndex=struct2array(load([carpeta,'Datos Procesados',sl,nFase.fase1,sl,nFase.pFase1,'_noNanIndex.mat']));
end
%% Fase 2 clasificacion de los patrones
%% Se detecta la existencia de los datos de fase2
exis=exist([carpeta,'Datos Procesados',sl,nFase.fase2,sl,nFase.pFase1,'_centroides.mat'],'file');
exis=exis&&exist([carpeta,'Datos Procesados',sl,nFase.fase2,sl,nFase.pFase1,'_clasifica.mat'],'file');
%Si no existen se clasifican los patrones
if ~exis
    %% Creacion de centroides unicos y clasificacion de los patrones en estos centroides
    clasifica=zeros(size(patrones,1),1);
    [ centroides,clasifica(noNanIndex,:) ] = centrUnicosO(patrones(noNanIndex,:),0.01,0.7,50000);
    %[ centroides,clasifica(noNanIndex) ] = centrUnicosO(patrones(noNanIndex,:),0.8,0.2,50000);
    %% Guardando variables procesadas
    %   Creando la carpeta fase2 (Centroides y clasificacion)
    [~,~,~]=mkdir(carpeta,'Datos Procesados');
    [~,~,~]=mkdir([carpeta,'Datos Procesados',sl],nFase.fase2);
    save([carpeta,'Datos Procesados',sl,nFase.fase2,sl,nFase.pFase1,'_centroides','.mat'],'centroides','-v7.3');
    save([carpeta,'Datos Procesados',sl,nFase.fase2,sl,nFase.pFase1,'_clasifica.mat'],'clasifica','-v7.3');
end
%% Cargando variables de la fase2 siempre y cuando ya no est�n en el workspace
exis=exist('centroides','var');
exis=exis&&exist('clasifica','var');
if ~exis
    centroides=struct2array(load([carpeta,'Datos Procesados',sl,nFase.fase2,sl,nFase.pFase1,'_centroides.mat']));
    clasifica=struct2array(load([carpeta,'Datos Procesados',sl,nFase.fase2,sl,nFase.pFase1,'_clasifica.mat']));
end
%% Se detecta la existencia de los datos de fase3
exis=exist([carpeta,'Datos Procesados',sl,nFase.fase3,sl,nFase.pFase1,'_transiciones','.mat'],'file');
%Si no existe entonces se crean las transiciones
if ~exis
    %% Fase 3 Creacion de transiciones unicas
    
    for i=1:length(nanIndex)
        if i==1
            [j,k,l]=transicionesUni2( clasifica(1:nanIndex(i)-1) );
        elseif i==length(nanIndex)
            [tj,tk,tl]=transicionesUni2( clasifica(nanIndex(i)+1:end) );
            %Combinando indices (j,k) y ocurrencias (l)
            [j,k,l]=combinar(j,k,l,tj,tk,tl);
            
        elseif nanIndex(i)+1<=nanIndex(i+1)-1
            [tj,tk,tl]=transicionesUni2( clasifica(nanIndex(i)+1:nanIndex(i+1)-1));
            %Combinando indices (j,k) y ocurrencias (l)
            [j,k,l]=combinar(j,k,l,tj,tk,tl);
        end
    end
    transiciones=uint32([j,k,l]);
    %% Guardando variables procesadas
    %   Creando la carpeta fase3 (Transiciones unicas)
    [~,~,~]=mkdir(carpeta,'Datos Procesados');
    [~,~,~]=mkdir([carpeta,'Datos Procesados',sl],nFase.fase3);
    save([carpeta,'Datos Procesados',sl,nFase.fase3,sl,nFase.pFase1,'_transiciones','.mat'],'transiciones','-v7.3');
end
%% Se cargan las variables de la fase3 siempre y cuando no existan en el workspace
exis=exist('transiciones','var');
exis=exis&exist('clasifica','var');
if ~exis
    load([carpeta,'Datos Procesados',sl,nFase.fase3,sl,nFase.pFase1,'_transiciones','.mat']); 
end
